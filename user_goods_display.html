<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>商品信息页</title>
    <link rel="stylesheet" type="text/css" href="lib/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <link rel="stylesheet" type="text/css" href="css/goods.css">
    <script src="js/request.js"></script>
    <script src="js/jquery-3.2.1.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/main.js"></script>
    <script type="text/javascript" src="js/Control.js"></script>
    <Script>
        let gid
        let uid

        function GetRequest() {
            let url = location.search; //获取url中"?"符后的字串
            let theRequest = new Object();
            if (url.indexOf("?") != -1) {
                let str = url.substr(1);
                let strs = str.split("&");
                for (let i = 0; i < strs.length; i++) {
                    theRequest[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
                }
            }
            return theRequest;
        }

        window.onload = function () {
            let Request = new Object()
            Request = GetRequest()
            gid = Request['gid']
            uid = Request['uid']
            usr_authorization()
        }

        function selectgoodsbyid() {
            request("http://127.0.0.1:8080/usr/goods/selectid", `id=${gid}`, res => {
                let area = document.getElementById("goods_display")
                let image = document.createElement("img")
                let description = document.createElement("div")
                let des = document.createElement("p")
                let cost = document.createElement("p")
                let buy = document.createElement("button")
                image.setAttribute("image", res.gimage)
                description.appendChild(document.createTextNode(res.gdescription))
                des.appendChild(document.createTextNode("¥" + res.gcost))
                description.appendChild(des)
                buy.className = "btn btn-primary goods_buy"
                buy.appendChild(document.createTextNode("购买"))
                image.src = res.gimage
                image.style = "width:500px;"
                area.appendChild(image)
                // description.appendChild(buy)
                // area.appendChild(description)
                buy.onclick = function () {
                    document.getElementById('modalbuy').style.display = "block"
                    document.getElementById("modalgoodsimage").src = image.getAttribute("image")
                    let coupon_list1 = document.getElementById("coupon_list1")
                    let coupon_list2 = document.getElementById("coupon_list2")
                    let coupon_list3 = document.getElementById("coupon_list3")
                    request("http://127.0.0.1:8080/usr/goods/readybuy", `uid=${uid}&gid=${gid}`, res => {
                        document.getElementById("modalgoodsnumber").value = res.gnumber
                        document.getElementById("modalgoodscost").value = res.cost
                        document.getElementById("modalgoodsdescription").value = res.cost
                        let couponlist = res.datalist
                        for (let i = 0; i < couponlist.length; i++) {
                            let couponimage = document.createElement("img")
                            couponimage.src = "images/couponimage.jpeg"
                            couponimage.style = "margin-top:5px;margin-bottom:5px;height:4rem;weight:5rem;"
                            let cell1 = document.createElement("p")
                            let cell2 = document.createElement("p")
                            let cell3 = document.createElement("p")
                            let _radio = document.createElement("input");
                            _radio.type = "radio";
                            _radio.name = "_radio";
                            if ((i + 1) % 2 == 0) {
                                coupon_list2.appendChild(couponimage)
                                cell1.appendChild(document.createTextNode(couponlist[i].cname))
                                cell3.appendChild(document.createTextNode("折扣度:" + couponlist[i].cdiscount))
                                _radio.name = "myradio"
                                _radio.value = couponlist[i].cid
                                coupon_list2.appendChild(cell1)
                                coupon_list2.appendChild(cell2)
                                coupon_list2.appendChild(cell3)
                                coupon_list2.appendChild(_radio)
                            } else if ((i + 1) % 3 == 0) {
                                coupon_list3.appendChild(couponimage)
                                cell1.appendChild(document.createTextNode(couponlist[i].cname))
                                cell3.appendChild(document.createTextNode("折扣度:" + couponlist[i].cdiscount))
                                _radio.value = couponlist[i].cid
                                _radio.name = "myradio"
                                coupon_list3.appendChild(cell1)
                                coupon_list3.appendChild(cell2)
                                coupon_list3.appendChild(cell3)
                                coupon_list3.appendChild(_radio)
                            } else {
                                coupon_list1.appendChild(couponimage)
                                cell1.appendChild(document.createTextNode(couponlist[i].cname))
                                cell3.appendChild(document.createTextNode("折扣度:" + couponlist[i].cdiscount))
                                _radio.value = couponlist[i].cid
                                _radio.name = "myradio"
                                coupon_list1.appendChild(cell1)
                                coupon_list1.appendChild(cell2)
                                coupon_list1.appendChild(cell3)
                                coupon_list1.appendChild(_radio)
                            }
                        }
                    })
                }
            })
        }

        function buy() {
            let cid
            let buy_number = document.getElementById("buy_number").value
            let myradios = document.getElementsByName("myradio")
            myradios.forEach(function (myradio) {
                if (myradio.checked) {
                    cid = myradio.value
                }
            })
            request("http://127.0.0.1:8080/usr/goods/buy", `uid=${uid}&gid=${gid}&cid=${cid}&number=${buy_number}`, res => {

            })
        }


    </Script>
</head>
<body onpageshow="selectgoodsbyid()">
<div class="goods_menu">
    <span>
</div>
<div class="row">
    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <div id="goods_display">
            <div style="color: black">
                <a href="" style="margin-left: 100px">2221</a>
            </div>
        </div>
        <div class="goods_padding"></div>
        <div class="goods_display">
            <p style="margin-left: 20px;margin-bottom: 0;">¥<label
                    style="margin-left: 5px;font-size: 30px;">58</label></p>
            <p style="margin-left: 20px;margin-top: -5px;">新品促销</p>
        </div>
        <div class="goods_indexdisplay">
            <div class="blackbox">
                <span class="glyphicon glyphicon-gift">小黑盒新品</span>
                <div class="goods_best"><p style="margin-left: 8px">优/选/新/品</p></div>
            </div>
        </div>
    </div>
    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <div class="goods_padding"></div>
    </div>
    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <div class="goods_display_des">
            <div class="goods_des1">
                <div class="goods_des1_1"><label style="margin-left: 8px;">促销季！购买得优惠</label></div>
                <div class="goods_des1_2"><label style="margin-left: 8px;">买一送一</label></div>
            </div>
        </div>
    </div>
    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <div class="goods_des2">
            <span class="glyphicon glyphicon-gift" style="margin-left:5px;margin-bottom: 3px">东睿专卖店</span>
        </div>
        <div class="goods_des2_1">
            <label style="color:silver;font-style: normal">&nbsp&nbsp来这里 逛新品！</label>
        </div>
    </div>
    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <div class="goods_des3">
            eqwe
        </div>
    </div>
</div>


<div id="modalbuy" class="modalgoodsbuy">
    <!--    商品详情拟态框　　-->
    <form class="modal-content animate">
        <div class="imgcontainer">
            <!-- 点击×号，隐藏模态框-->
            <span onclick="document.getElementById('modalbuy').style.display='none'" class="close"
                  title="Close Modal">×</span>
        </div>

        <div class="container" style="color: #0d1214">
            <div class="row">
                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">

                    <div class="imagebox">
                        <img src="" id="modalgoodsimage" alt="Avatar" class="avatar"
                             style="margin-top: 5px;width: 20rem;height: 30rem"/>
                    </div>
                </div>
                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                    <br><br><br>
                    <label style="color: red;font-size: 25px;">¥</label>
                    <label id="modalgoodscost"></label>
                    <br><br>
                    <label>库存数量:</label>
                    <label id="modalgoodsnumber"></label>
                    <br>
                    <label id="modalgoodsdescription"></label>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center"
                     style="margin-top: 15px;border-top:1px dashed #000 ">
                    <label>我的优惠券</label>
                </div>

                <div id="coupon_list1" class="col-lg-4 col-md-4 col-sm-4 col-xs-4 text-center"
                     style="height: 270px;">

                </div>
                <div id="coupon_list2" class="col-lg-4 col-md-4 col-sm-4 col-xs-4 text-center"
                     style="height: 270px;">

                </div>
                <div id="coupon_list3" class="col-lg-4 col-md-4 col-sm-4 col-xs-4 text-center"
                     style="height: 270px;">

                </div>
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="border-top:1px dashed #000 ">
                    <label>购买数量&nbsp&nbsp</label>
                    <input id="buy_number" type="text"/>
                </div>
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <button type="button" class="btn btn-primary" style="margin-left: 380px;" onclick="buy()">点击结算
                    </button>
                </div>
            </div>

        </div>
    </form>
</div>
</body>
</html>